---
tags: [general]
---

# Описание API


## Введение

### Локальные и удаленные CRUD-вызовы
Под локальными CRUD-вызовами понимаются вызовы к API Zonesmart для создания/получения/обновления/удаления сущностей (экземпляров моделей БД) в системе Zonesmart (операции в БД). 

Под удаленными CRUD-вызовами понимаются вызовы к API маркетплейса для публикации на маркетплейсе/загрузки из маркетплейса/обновления в маркетплейсе/удаления с маркетплейса сущностей данного маркетплейса через API Zonesmart.

### Статусы сущностей
Все сущности, для которых доступны как локальные, так и удаленные CRUD-вызовы, обладают статусом. Возможные значения статуса: 'draft', 'ready_to_be_published', 'published' и 'update_required'.

В зависимости от статуса для сущностью могут быть доступны различные операции (соответственно и вызовы API).

Статус 'draft' (черновик) означает, что сущность нельзя опубликовать на маркетплейсе, так как у нее не заполнены какие-то нужные поля. Для сущностей с этим статусом доступны только локальные CRUD-вызовы, но не операция публикации на маркетплейсе.

Статус 'ready_to_be_published' означает, что сущность создана локально, все ее необходимые для публикации на маркетплейсе поля заполнены, но она еще не была опубликована.

Статус 'published' означает, что сущность опубликована на маркетплейсе и полностью синхронизирована, то есть значения соответствующих полей локально (в БД) и в маркетплейсе одинаковы. Для сущности с этим статусом доступна операция удаления с маркетплейса. 

Статус 'update_required' означает, что сущность опубликована на маркетплейсе, но для нее требуется синхронизация, так как она обновлена локально (в БД), но еще не обновлена на маркетплейсе, то есть значения каких-то соответствующих полей различаются. Для сущности с данным статусом доступны операции обновления на маркетплейсе и удаления с маркетплейса.

## Описание папок документации

Ниже приводится объяснение назначения папок документации, содержащих описание тематически связанных эндпоинтов API. По ходу описания последовательно вводится специфичная терминология Zonesmart API и приводятся примеры работы с ним.


### Zonesmart

В данном разделе приводится описание папок с эндпоинтами, не относящимися к конкретному маркетплейсу.


#### Auth
Вызовы для получения и обновления токенов авторизации в системе. Аутентификация клиента основана на стандарте JSON Web Token (JWT). Для авторизованного запроса к API Zonesmart требуется передача JWT-токена. Токен имеет время жизни и требует периодического обновления. Для создания токена нужны email и пароль зарегистрированного активного аккаунта.


#### User
Локальные CRUD-вызовы для пользователя Zonesmart, верификация телефона и email, смена пароля.


#### Marketplace
Получение доступных для интеграции маркетплейсов.


#### MarketplaceUserAccount
Получение созданных аккаунтов маркетплейсов пользователя. Аккаунт маркетплейса - сущность, связывающая пользователя маркетплейс.

Аккаунт маркетплейса создается автоматически при подключении пользователем своей учетной записи в одном из маркетплейсов. Например, при подключении пользователем двух своих личных учетных записей eBay автоматически будут созданы 2 аккаунта маркетплейса, ссылающихся на маркетплейс eBay и данного пользователя (различия будут в полях 'id' и 'username').
 
Аккаунтов маркетплейсов у пользователя может быть неограниченно много при том условии, что они все соответствуют разным учетным записям, то есть одну и ту же учетную запись нельзя подключить более одного раза.


#### Domain
Получение доменов маркетплейсов. Домены привязаны к маркетплейсам и имеют уникальный идентификатор 'code'. У любого маркетплейса есть хотя бы один домен (Etsy и AliExpress имеют единственный домен), а некоторые маркетплейсы имеют много доменов для разных регионов (например, Amazon и eBay). 


#### Channel
Локальные CRUD-вызовы для каналов продаж аккаунтов маркетплейсов. 

Канал продаж - сущность, связывающая аккаунт маркетплейса и домен маркетплейса. У аккаунта маркетплейса может быть только по одному каналу продаж для каждого домена маркетплейса. К примеру, в eBay нельзя создать 2 канала продаж для немецкого домена 'ebay.de', привязанных к одному и тому же аккаунту маркетплейса, но можно создать по одному каналу продаж домена 'ebay.de' для каждого аккаунта маркетплейса eBay.


#### BaseListing
Локальные CRUD-вызовы для базовых листингов и их базовых продуктов. 

Базовый листинг - сущность, которая служит для хранения информации о товаре и используется для создания листингов. На основе базового листинга можно создать неограниченное число листингов для любого маркетплейса без повторного ввода повторяющейся информации, вроде названия и описания товара.

К любому базовому листингу должен быть привязан хотя бы один базовый продукт. Базовый продукт содержит информацию, которая может различаться между вариациями листинга, вроде SKU, цены и количества. Если товар имеет вариации, то к базовому листингу должно быть привязано равное количество базовых продуктов. 

К базовому продукту могут быть привязаны атрибуты, представляющие из себя пары "ключ-значение". У всех продуктов, привязанных к листингу, должен быть хотя бы один атрибут, по которому они различаются, то есть атрибут с одним и тем же ключем, но разными значениями.

Продемонстрируем workflow на примере футболок. Если пользователь хочет продавать футболки на нескольких маркетплейсах, то сперва он должен создать по базовому листингу для футболок разных брендов (различающихся в том числе названием и описанием). Если футболки одного бренда различаются размером и цветом, то для каждой из вариаций должен быть создан базовый продукт с привязанными к нему двумя атрибутами: "цвет-значение" и "размер-значение" (для двух размеров и трех цветов будет таким образом 2*3=6 базовых продуктов с двумя атрибутами каждый). Если футболки одного бренда не имеют вариаций, то нужно создать только один продукт, причем привязывать к нему атрибуты допустимо, но необязательно.


#### BaseOrder
Получение базовых заказов со всех подключенных аккаунтов маркетплейсов и создание отправлений для них (если это поддерживается API маркетплейса).

Базовый заказ - сущность, содержащая информацию о заказе, полученном с какого-либо маркетплейса, причем набор полей данной модели не зависит от того, к какому маркетплейсу относится заказ (проводится маппинг соответствующих базовых полей заказов с неизбежной потерей потерей специфичных, но не существенных, для маркетплейса полей). Базовый заказ содержит информацию о дате, статусе, стоимости и покупателе. 

К каждому базовому заказу привязан хотя бы один элемент заказа, соответствующий одному заказанному товару. Есть покупатель заказал (в рамках одного заказа) несколько различных товаров (листингов какого-то маркетплейса), то для каждого из товаров создается по элементу заказа. Элемент базового заказа содержит информацию о названии, SKU, цене и заказонном количестве товара. Если товар из заказа представлен в системе Zonesmart в виде базового листинга, то заказ привязывается к этому листингу, что открывает дополнительные возможности для его обработки.

Базовый товар можно отметить отправленным и следить за изменением статуса его фулфилмента. 


### Ebay

В данном разделе приводится описание папок с эндпоинтами, относящимися к маркетплейсу eBay. 


#### Ebay Account
Локальные CRUD-вызовы для аккаунта eBay. 

Для работы с маркетплейсом пользователь должен добавить в систему один или несколько своих аккаунтов данного маркетплейса (например, два аккаунта eBay, зарегистрированные на два разных email). 

Подключение аккаунта eBay осуществляется по протоколу OAuth. Пользователь перенаправляется на сайт eBay, где он должен авторизоваться через подключаемый аккаунт и принять условия предоставления доступа приложения Zonesmart к своему аккаунту, нажав соответствующую кнопку. После дачи согласия, пользователь перенаправляется обратно на сайт Zonesmart, завершая подключение аккаунта. Интеграция будет не будет успешной, если аккаунт не является активным (например, был деактивирован сайтом eBay) или уже был до этого подключен другим пользователем Zonesmart.

Для каждого подключенного аккаунта eBay создается единственный аккаунт маркетплейса (связь "один к одному"), который также удаляется при удалении аккаунта eBay из системы.

Аккаунт eBay хранит токены доступа к API eBay, полученные при подключении (авторизации приложения Zonesmart в учетной записи eBay пользователя). Токен доступа к eBay API обновляется автоматически вплоть до устаревания токена обновления, после чего требуется обновление аккаунта eBay (по сути повторное подключение по протоколу OAuth).

После подключения аккаунта eBay автоматически происходит скачивание всех связанных с ним сущностей, вроде листингов, складов и политик eBay.


#### Ebay Category
Получение категорий товаров для различных доменов eBay. Категории доступны в базе данных без предварительного скачивания и обновляются автоматически.


#### Ebay Location
Локальные и удаленные CRUD-вызовы для складов eBay. Склады можно создавать и публиковать на eBay через систему Zonesmart, либо создавать на сайте eBay и загружать в Zonesmart. Автоматически с eBay склады загружаются только при подключении нового аккаунта eBay. То же относится к политикам eBay.


#### Ebay Fulfillment Policy
Локальные и удаленные CRUD-вызовы для политик фулфилмента (доставки) eBay.


#### Ebay Payment Policy
Локальные и удаленные CRUD-вызовы для политик оплаты eBay.


#### Ebay Return Policy
Локальные и удаленные CRUD-вызовы для политик возврата eBay.


#### Ebay Listing
Локальные и удаленные CRUD-вызовы для листингов eBay. Для создания листингов необходимо использовать категории, склады и все политики eBay, существующие в системе Zonesmart. Для работы с листингом eBay необходимо, чтобы он был привязан к базовому листингу. Листинг eBay можно создать на основе базового листинга, либо скачать с аккаунта eBay пользователя и привязать к базовому листингу пользователя. 

Связь между базовым листингом используется для управления ценами и количеством единиц публикуемых на маркетплейсах листингов, относящихся к одному и тому же реальному продаваемому пользователем товару.

Подобно базовому листингу, листинг eBay имеет привязанные к нему продукты eBay, а они в свою очередь - привязанные к ним атрибуты типа "ключ-значение". Между продуктами и атрибутами базового листинга и продуктами и атрибутами созданного на его основе листинга eBay существует однозначное соответствие. 


#### Ebay Order
Загрузка заказов c eBay и их сохранение в виде базовых заказов.


### Etsy

В данном разделе приводится описание папок с эндпоинтами, относящимися к маркетплейсу Etsy.


#### Etsy Account


#### Etsy Category


#### Etsy Shipping Template


#### Etsy Listing


#### Etsy Order


### Amazon

В данном разделе приводится описание папок с эндпоинтами, относящимися к маркетплейсу Amazon.


#### Amazon Account


#### Amazon Category


#### Amazon Order

